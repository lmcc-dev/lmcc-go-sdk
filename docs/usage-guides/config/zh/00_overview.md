# 配置模块概述

`pkg/config` 模块为 Go 应用程序提供了全面的配置管理解决方案。它旨在处理复杂的配置场景，同时为基本用例保持简单性。

## 架构

配置模块围绕几个关键组件构建：

### 核心组件

1. **管理器接口**：中央配置管理接口
2. **选项系统**：使用函数选项模式的灵活配置选项
3. **回调系统**：事件驱动的配置变更通知
4. **类型系统**：常见用例的预定义配置结构

### 配置流程

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│    配置文件     │    │    环境变量      │    │     默认值      │
│   (YAML/JSON)   │    │                  │    │  (结构体标签)   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────▼──────────────┐
                    │        Viper 核心         │
                    │      (配置聚合)           │
                    │                           │
                    └─────────────┬──────────────┘
                                 │
                    ┌─────────────▼──────────────┐
                    │     mapstructure          │
                    │      (类型转换)           │
                    └─────────────┬──────────────┘
                                 │
                    ┌─────────────▼──────────────┐
                    │    用户配置结构体         │
                    │     (强类型)              │
                    └───────────────────────────┘
```

## 主要特性

### 1. 多配置源

模块支持从多个源加载配置，具有明确的优先级顺序：

1. **命令行标志**（最高优先级）
2. **环境变量**
3. **配置文件**
4. **默认值**（最低优先级）

### 2. 热重载支持

可以监控配置文件的更改，当发生更新时，应用程序可以自动收到通知。

### 3. 类型安全

所有配置都通过用户定义的结构体进行强类型化，提供编译时安全性和 IDE 支持。

### 4. 灵活选项

模块使用函数选项模式，允许清洁和可扩展的 API 设计。

## 支持的文件格式

- **YAML**（推荐）
- **JSON**
- **TOML**
- **HCL**
- **INI**
- **Properties**

## 环境变量绑定

自动将环境变量绑定到配置字段，具有：
- 可配置前缀
- 自动键转换（点转下划线）
- 类型转换

## 默认值系统

可以使用结构体标签指定默认值：

```go
type Config struct {
    Port     int    `mapstructure:"port" default:"8080"`
    Host     string `mapstructure:"host" default:"localhost"`
    Debug    bool   `mapstructure:"debug" default:"false"`
    Timeout  string `mapstructure:"timeout" default:"30s"`
}
```

## 错误处理

模块提供全面的错误处理，针对不同的失败场景提供特定的错误代码：

- 配置文件未找到
- 无效配置格式
- 类型转换错误
- 验证失败

## 线程安全

所有操作都是线程安全的，允许并发访问配置数据和安全的热重载操作。

## 集成点

配置模块设计为与以下模块无缝集成：

- **日志模块**（`pkg/log`）- 用于配置驱动的日志设置
- **错误处理**（`pkg/errors`）- 用于一致的错误报告
- **应用程序框架** - 通过回调机制

## 下一步

- [快速开始指南](01_quick_start.md) - 开始基本配置
- [配置选项](02_configuration_options.md) - 了解所有可用选项
- [热重载](03_hot_reload.md) - 实现动态配置更新 